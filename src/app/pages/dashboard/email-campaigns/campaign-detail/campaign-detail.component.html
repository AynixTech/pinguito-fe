<div class="campaign-detail-container" *ngIf="!loading && campaign">
  <div class="header">
    <button class="btn-back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      Torna alla lista
    </button>
    <h1>
      <i class="fas fa-envelope-open-text"></i>
      {{ campaign.name }}
    </h1>
  </div>

  <!-- Campaign Summary -->
  <div class="campaign-summary">
    <div class="summary-card">
      <h2>Dettagli Campagna</h2>
      <div class="detail-grid">
        <div class="detail-item">
          <span class="label">Oggetto:</span>
          <span class="value">{{ campaign.subject }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Stato:</span>
          <span class="value">
            <span class="status-badge" [ngClass]="getStatusClass(campaign.status)">
              {{ getStatusLabel(campaign.status) }}
            </span>
          </span>
        </div>
        <div class="detail-item">
          <span class="label">Data creazione:</span>
          <span class="value">{{ campaign.createdAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
        <div class="detail-item" *ngIf="campaign.sentAt">
          <span class="label">Data invio:</span>
          <span class="value">{{ campaign.sentAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon recipients">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ campaign.recipientCount || 0 }}</div>
          <div class="stat-label">Destinatari Totali</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon success">
          <i class="fas fa-paper-plane"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ campaign.sentCount || 0 }}</div>
          <div class="stat-label">Email Inviate</div>
        </div>
      </div>

      <div class="stat-card" *ngIf="getFailedCount() > 0">
        <div class="stat-icon danger">
          <i class="fas fa-times-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getFailedCount() }}</div>
          <div class="stat-label">Non Inviate</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon info">
          <i class="fas fa-envelope-open"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ campaign.openedCount || 0 }} <span class="percentage">({{ getOpenRate() }}%)</span></div>
          <div class="stat-label">Email Aperte</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon warning">
          <i class="fas fa-mouse-pointer"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ campaign.clickedCount || 0 }} <span class="percentage">({{ getClickRate() }}%)</span></div>
          <div class="stat-label">Click Registrati</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Email Logs Section -->
  <div class="logs-section">
    <div class="logs-header">
      <h2>
        <i class="fas fa-list"></i>
        Registro Email ({{ filteredLogs.length }})
      </h2>
      
      <div class="logs-filters">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            (input)="filterLogs()"
            placeholder="Cerca per email o nome...">
        </div>

        <select [(ngModel)]="statusFilter" (change)="filterLogs()" class="status-filter">
          <option value="">Tutti gli stati</option>
          <option value="sent">Inviate</option>
          <option value="opened">Aperte</option>
          <option value="clicked">Click</option>
          <option value="failed">Fallite</option>
        </select>
      </div>
    </div>

    <div class="logs-table">
      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>Nome Contatto</th>
            <th>Stato</th>
            <th>Data Invio</th>
            <th>Data Apertura</th>
            <th>Data Click</th>
            <th>Errore</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of filteredLogs">
            <td><strong>{{ log.email }}</strong></td>
            <td>{{ log.contactName }}</td>
            <td>
              <span class="log-status" [ngClass]="getStatusClass(log.status)">
                <i class="fas" [ngClass]="getStatusIcon(log.status)"></i>
                {{ getStatusLabel(log.status) }}
              </span>
            </td>
            <td>{{ log.sentAt | date: 'dd/MM/yyyy HH:mm' || '-' }}</td>
            <td>{{ log.openedAt | date: 'dd/MM/yyyy HH:mm' || '-' }}</td>
            <td>{{ log.clickedAt | date: 'dd/MM/yyyy HH:mm' || '-' }}</td>
            <td>
              <span class="error-message" *ngIf="log.errorMessage">
                <i class="fas fa-exclamation-triangle"></i>
                {{ log.errorMessage }}
              </span>
              <span *ngIf="!log.errorMessage">-</span>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredLogs.length === 0" class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>Nessun log trovato</p>
      </div>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>Caricamento dettagli campagna...</p>
</div>
