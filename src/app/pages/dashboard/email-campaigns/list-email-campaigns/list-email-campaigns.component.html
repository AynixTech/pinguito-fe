<div class="campaigns-container">
  <div class="header">
    <h1>
      <i class="fas fa-envelope-open-text"></i>
      Campagne Email
      <span class="company-badge" *ngIf="companyName">
        <i class="fas fa-building"></i> {{ companyName }}
      </span>
    </h1>
    <button class="btn btn-primary" routerLink="/dashboard/email-campaigns/create">
      <i class="fas fa-plus"></i>
      Nuova Campagna
    </button>
  </div>

  <div class="filters">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="filterCampaigns()"
        placeholder="Cerca per nome o oggetto...">
    </div>

    <select [(ngModel)]="statusFilter" (change)="filterCampaigns()" class="status-filter">
      <option value="">Tutti gli stati</option>
      <option value="draft">Bozze</option>
      <option value="scheduled">Programmate</option>
      <option value="sending">In invio</option>
      <option value="sent">Inviate</option>
      <option value="failed">Fallite</option>
    </select>
  </div>

  <div class="campaigns-table">
    <table>
      <thead>
        <tr>
          <th>Nome Campagna</th>
          <th>Oggetto</th>
          <th>Destinatari</th>
          <th>Stato</th>
          <th>Statistiche</th>
          <th>Data</th>
          <th>Azioni</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let campaign of filteredCampaigns" class="clickable-row" (click)="viewCampaign(campaign.uuid!)">
          <td><strong>{{ campaign.name }}</strong></td>
          <td>{{ campaign.subject }}</td>
          <td>{{ campaign.recipientCount || 0 }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(campaign.status)">
              {{ getStatusLabel(campaign.status) }}
            </span>
          </td>
          <td>
            <div class="stats" *ngIf="showStats(campaign)">
              <div class="stat-item">
                <i class="fas fa-paper-plane stat-icon success"></i>
                <div class="stat-content">
                  <span class="stat-value">{{ campaign.sentCount || 0 }}</span>
                  <span class="stat-label">Inviate</span>
                </div>
              </div>
              <div class="stat-item" *ngIf="getFailedCount(campaign) > 0">
                <i class="fas fa-times-circle stat-icon danger"></i>
                <div class="stat-content">
                  <span class="stat-value">{{ getFailedCount(campaign) }}</span>
                  <span class="stat-label">Non inviate</span>
                </div>
              </div>
              <div class="stat-item" *ngIf="campaign.sentCount && campaign.sentCount > 0">
                <i class="fas fa-envelope-open stat-icon info"></i>
                <div class="stat-content">
                  <span class="stat-value">{{ campaign.openedCount || 0 }} ({{ getOpenRate(campaign) }}%)</span>
                  <span class="stat-label">Aperte</span>
                </div>
              </div>
              <div class="stat-item" *ngIf="campaign.clickedCount && campaign.clickedCount > 0">
                <i class="fas fa-mouse-pointer stat-icon warning"></i>
                <div class="stat-content">
                  <span class="stat-value">{{ campaign.clickedCount || 0 }} ({{ getClickRate(campaign) }}%)</span>
                  <span class="stat-label">Click</span>
                </div>
              </div>
            </div>
            <span class="no-stats" *ngIf="!showStats(campaign)">-</span>
          </td>
          <td>{{ (campaign.sentAt || campaign.createdAt) | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <div class="actions">
              <button 
                *ngIf="campaign.status === 'draft'" 
                class="btn-icon btn-send"
                (click)="sendCampaign(campaign.uuid!)"
                title="Invia">
                <i class="fas fa-paper-plane"></i>
              </button>
              <button 
                class="btn-icon btn-delete"
                (click)="deleteCampaign(campaign.uuid!)"
                title="Elimina">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredCampaigns.length === 0" class="empty-state">
      <i class="fas fa-envelope"></i>
      <p>Nessuna campagna trovata</p>
      <button class="btn btn-primary" routerLink="/dashboard/email-campaigns/create">
        Crea la tua prima campagna
      </button>
    </div>
  </div>
</div>
